<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Insight – First Half Analyzer</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    /* Minimal styles in case style.css doesn't cover these */
    .container{max-width:960px;margin:24px auto;padding:16px}
    .card{border:1px solid #ddd;border-radius:14px;padding:16px}
    .grid{display:grid;gap:12px}
    .grid-3{grid-template-columns:repeat(3,1fr)}
    .row{display:flex;gap:8px;align-items:center}
    .btn{padding:10px 14px;border-radius:10px;border:1px solid #333;background:#111;color:#fff;cursor:pointer}
    .btn.outline{background:#fff;color:#111}
    .muted{opacity:.7}
    .pill{font-size:12px;border:1px solid #ccc;border-radius:999px;padding:3px 8px}
    .progress{height:8px;background:#eee;border-radius:20px;overflow:hidden}
    .progress > div{height:100%;background:#111;width:0%}
    .list{padding-left:18px}
    .badge{display:inline-block;width:16px;height:16px;border-radius:50%;border:1px solid #ccc}
    .hidden{display:none}
    .error{background:#fee;border:1px solid #fca5a5;color:#991b1b;padding:12px;border-radius:10px}
  </style>
</head>
<body>
  <div class="container">
    <h1>AI Insight</h1>
    <p class="muted">Analyze the <strong>first half</strong> of a game video for stats, strengths, weaknesses, and improvement ideas.</p>

    <div class="card grid">
      <form id="ai-form" class="grid" enctype="multipart/form-data">
        <div class="grid grid-3">
          <label class="grid">
            <span>Team Name</span>
            <input type="text" id="teamName" name="teamName" placeholder="River City Raptors" required />
          </label>
          <label class="grid">
            <span>Team Color</span>
            <div class="row">
              <input type="color" id="teamColor" name="teamColor" value="#0ea5e9" title="Pick color" />
              <input type="text" id="teamColorHex" value="#0ea5e9" />
            </div>
          </label>
          <label class="grid">
            <span>Player Number</span>
            <input type="number" id="playerNumber" name="playerNumber" placeholder="5" min="0" required />
          </label>
        </div>

        <label class="grid">
          <span>Game Video</span>
          <input type="file" id="video" name="video" accept="video/*" required />
        </label>

        <div class="progress" id="uploadProgress" aria-hidden="true"><div></div></div>

        <div class="row">
          <button type="submit" class="btn" id="analyzeBtn">Analyze First Half</button>
          <button type="button" class="btn outline" id="resetBtn">Reset</button>
          <span class="muted" id="statusText"></span>
        </div>
      </form>
    </div>

    <div id="errorBox" class="error hidden"></div>

    <div id="result" class="grid" style="margin-top:20px"></div>
  </div>

  <script>
    // --- Config ---
    // If your backend runs on a different host/port, set FULL URL here, e.g.:
    // const API_URL = "http://localhost:5050/api/ai-insight/analyze";
    const API_URL = "/api/ai-insight/analyze"; // same-origin proxy or backend mounted under site

    const form = document.getElementById('ai-form');
    const teamNameEl = document.getElementById('teamName');
    const teamColorEl = document.getElementById('teamColor');
    const teamColorHexEl = document.getElementById('teamColorHex');
    const playerNumberEl = document.getElementById('playerNumber');
    const videoEl = document.getElementById('video');
    const progressEl = document.getElementById('uploadProgress');
    const progressBar = progressEl.querySelector('div');
    const statusText = document.getElementById('statusText');
    const resultEl = document.getElementById('result');
    const errorBox = document.getElementById('errorBox');
    const analyzeBtn = document.getElementById('analyzeBtn');
    const resetBtn = document.getElementById('resetBtn');

    // sync color inputs
    teamColorEl.addEventListener('input', () => teamColorHexEl.value = teamColorEl.value);
    teamColorHexEl.addEventListener('input', () => teamColorEl.value = teamColorHexEl.value);

    resetBtn.addEventListener('click', () => {
      form.reset();
      teamColorEl.value = '#0ea5e9';
      teamColorHexEl.value = '#0ea5e9';
      progressEl.setAttribute('aria-hidden','true');
      progressBar.style.width = '0%';
      statusText.textContent = '';
      resultEl.innerHTML = '';
      errorBox.classList.add('hidden');
      errorBox.textContent = '';
    });

    form.addEventListener('submit', function(e){
      e.preventDefault();
      errorBox.classList.add('hidden');
      errorBox.textContent = '';

      const file = videoEl.files && videoEl.files[0];
      if(!file){
        showError('Please choose a video file.');
        return;
      }

      const fd = new FormData();
      fd.append('teamName', teamNameEl.value.trim());
      fd.append('teamColor', teamColorEl.value.trim());
      fd.append('playerNumber', String(playerNumberEl.value || ''));
      fd.append('video', file);

      analyzeBtn.disabled = true;
      statusText.textContent = 'Uploading…';
      progressEl.removeAttribute('aria-hidden');

      const xhr = new XMLHttpRequest();
      xhr.open('POST', API_URL);
      xhr.responseType = 'json';

      xhr.upload.onprogress = (evt) => {
        if (evt.lengthComputable) {
          const pct = Math.round((evt.loaded / evt.total) * 100);
          progressBar.style.width = pct + '%';
        }
      };

      xhr.onerror = () => {
        showError('Network error during upload.');
        analyzeBtn.disabled = false;
      };

      xhr.onload = () => {
        analyzeBtn.disabled = false;
        statusText.textContent = '';
        if(xhr.status >= 200 && xhr.status < 300){
          const data = xhr.response || {};
          renderResult(data);
        } else {
          const msg = (xhr.response && xhr.response.error) ? xhr.response.error : 'Server error (' + xhr.status + ')';
          showError(msg);
        }
      };

      xhr.send(fd);
    });

    function showError(msg){
      errorBox.textContent = msg;
      errorBox.classList.remove('hidden');
    }

    // === DOM-based renderer (no template strings) ===
    function renderResult(r){
      const teamName = r?.team?.name || teamNameEl.value;
      const teamColor = r?.team?.color || teamColorEl.value;
      const playerNo  = r?.team?.playerNumber || playerNumberEl.value;
      const model     = r?.model || 'AI';

      const stats       = r?.stats || {};
      const strengths   = r?.strengths || [];
      const weaknesses  = r?.weaknesses || [];
      const areas       = r?.areasForImprovement || [];
      const suggestions = r?.suggestions || [];
      const keyMoments  = r?.keyMoments || [];

      // clear container
      resultEl.innerHTML = "";

      // header
      const header = document.createElement("div");
      header.className = "card row";
      header.style.justifyContent = "space-between";

      const left = document.createElement("div");
      left.className = "row";
      const badge = document.createElement("span");
      badge.className = "badge";
      badge.style.background = teamColor;
      const h2 = document.createElement("h2");
      h2.style.margin = "0";
      h2.textContent = `${teamName} — #${playerNo}`;
      left.appendChild(badge); left.appendChild(h2);

      const modelPill = document.createElement("span");
      modelPill.className = "pill muted";
      modelPill.textContent = `Model: ${model}`;

      header.appendChild(left);
      header.appendChild(modelPill);
      resultEl.appendChild(header);

      // stats
      const statsSec = document.createElement("section");
      statsSec.className = "grid";
      statsSec.style.marginTop = "8px";
      const statsH = document.createElement("h3");
      statsH.textContent = "Stats (first half)";
      const statsGrid = document.createElement("div");
      statsGrid.className = "grid grid-3";

      const keys = Object.keys(stats);
      if(keys.length === 0){
        const no = document.createElement("div");
        no.className = "muted";
        no.textContent = "No stats detected.";
        statsGrid.appendChild(no);
      } else {
        keys.forEach(k=>{
          const card = document.createElement("div");
          card.className = "card";
          const label = document.createElement("div");
          label.className = "muted";
          label.style.fontSize = "12px";
          label.textContent = k;
          const val = document.createElement("div");
          val.style.fontWeight = "700";
          val.style.fontSize = "20px";
          val.textContent = String(stats[k]);
          card.appendChild(label); card.appendChild(val);
          statsGrid.appendChild(card);
        });
      }
      statsSec.appendChild(statsH); statsSec.appendChild(statsGrid);
      resultEl.appendChild(statsSec);

      // trio lists
      const trio = document.createElement("section");
      trio.className = "grid";
      trio.style.marginTop = "8px";
      const trioGrid = document.createElement("div");
      trioGrid.className = "grid grid-3";
      trioGrid.appendChild(makeListCard("Strengths", strengths));
      trioGrid.appendChild(makeListCard("Weaknesses", weaknesses));
      trioGrid.appendChild(makeListCard("Areas for Improvement", areas));
      trio.appendChild(trioGrid);
      resultEl.appendChild(trio);

      // suggestions
      const sugSec = document.createElement("section");
      sugSec.className = "grid";
      sugSec.style.marginTop = "8px";
      const sugH = document.createElement("h3"); sugH.textContent = "Suggestions";
      sugSec.appendChild(sugH);
      sugSec.appendChild(makeBullets(suggestions));
      resultEl.appendChild(sugSec);

      // key moments
      if (keyMoments.length){
        const kmSec = document.createElement("section");
        kmSec.className = "grid";
        kmSec.style.marginTop = "8px";
        const kmH = document.createElement("h3"); kmH.textContent = "Key Moments";
        const ul = document.createElement("ul");
        ul.className = "grid"; ul.style.gap = "8px"; ul.style.listStyle = "none";
        ul.style.padding = "0"; ul.style.margin = "0";
        keyMoments.forEach(m=>{
          const li = document.createElement("li");
          li.className = "row";
          const t = document.createElement("span");
          t.className = "pill"; t.style.fontSize = "12px";
          t.textContent = m?.t || "approx";
          const note = document.createElement("span");
          note.textContent = m?.note || "";
          li.appendChild(t); li.appendChild(note);
          ul.appendChild(li);
        });
        kmSec.appendChild(kmH); kmSec.appendChild(ul);
        resultEl.appendChild(kmSec);
      }

      // actions
      const actions = document.createElement("section");
      actions.className = "row";
      actions.style.marginTop = "8px";
      const copyBtn = document.createElement("button");
      copyBtn.className = "btn outline"; copyBtn.textContent = "Copy JSON";
      const dl = document.createElement("a");
      dl.className = "btn outline"; dl.textContent = "Download JSON"; dl.href = "#";
      actions.appendChild(copyBtn); actions.appendChild(dl);
      resultEl.appendChild(actions);

      const jsonStr = JSON.stringify(r, null, 2);
      copyBtn.onclick = () => navigator.clipboard.writeText(jsonStr);
      dl.onclick = (e) => {
        e.preventDefault();
        const url = 'data:application/json;charset=utf-8,' + encodeURIComponent(jsonStr);
        dl.setAttribute('href', url);
        dl.setAttribute('download', `ai-insight-${Date.now()}.json`);
      };
    }

    function makeListCard(title, items){
      const card = document.createElement("div");
      card.className = "card";
      const h4 = document.createElement("h4");
      h4.style.marginTop = "0"; h4.textContent = title;
      card.appendChild(h4);
      if(items && items.length){
        card.appendChild(makeBullets(items));
      } else {
        const no = document.createElement("div");
        no.className = "muted"; no.textContent = "No items";
        card.appendChild(no);
      }
      return card;
    }

    function makeBullets(items){
      const ul = document.createElement("ul");
      ul.className = "list";
      (items || []).forEach(s=>{
        const li = document.createElement("li");
        li.textContent = String(s);
        ul.appendChild(li);
      });
      return ul;
    }
  </script>
</body>
</html>






